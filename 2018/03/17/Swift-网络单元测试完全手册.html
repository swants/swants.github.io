<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Swift ç½‘ç»œå•å…ƒæµ‹è¯•å®Œå…¨æ‰‹å†Œ"/>




  <meta name="keywords" content="swants å¡ä¸‡ææ–¯  saiwantisi åšå®¢ å¼€å‘è€…,ç¨‹åºçŒ¿,ç¨‹åºåª›,æå®¢,ç¼–ç¨‹,ä»£ç ,å¼€æº,ITç½‘ç«™,Developer,Programmer,Coder,Geek" />










  <link rel="alternate" href="/default" title="å¡ä¸‡ææ–¯">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.5.0" />



<link rel="canonical" href="https://swants.cn/2018/03/17/Swift-ç½‘ç»œå•å…ƒæµ‹è¯•å®Œå…¨æ‰‹å†Œ.html"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.5.0" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>



    <title> Swift ç½‘ç»œå•å…ƒæµ‹è¯•å®Œå…¨æ‰‹å†Œ - å¡ä¸‡ææ–¯ </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">å¡ä¸‡ææ–¯</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            é¦–é¡µ
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            å½’æ¡£
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            å…³äºæˆ‘
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">å¡ä¸‡ææ–¯</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              é¦–é¡µ
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              å½’æ¡£
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              å…³äºæˆ‘
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Swift ç½‘ç»œå•å…ƒæµ‹è¯•å®Œå…¨æ‰‹å†Œ
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-03-17
        </span>
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#TL-DR"><span class="toc-text">TL;DR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¾èµ–æ³¨å…¥"><span class="toc-text">ä¾èµ–æ³¨å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æµ‹è¯•æ•°æ®"><span class="toc-text">æµ‹è¯•æ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æµ‹è¯•è¡Œä¸º"><span class="toc-text">æµ‹è¯•è¡Œä¸º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€»ç»“"><span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å‚è€ƒæ–‡çŒ®"><span class="toc-text">å‚è€ƒæ–‡çŒ®</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p><img src="/images/blog04/01.png" alt="image">  </p>
<p>ä¸å¾—ä¸æ‰¿è®¤ï¼Œå¯¹äº iOS å¼€å‘å†™æµ‹è¯•å¹¶ä¸æ˜¯å¾ˆæ™®é(è‡³å°‘å’Œåç«¯å†™æµ‹è¯•ç¨‹åº¦ç›¸æ¯”)ã€‚æˆ‘è¿‡å»æ˜¯ä¸ªç‹¬ç«‹å¼€å‘è€…è€Œä¸”æœ€åˆä¹Ÿæ²¡ç»è¿‡åŸç”Ÿâ€œæµ‹è¯•é©±åŠ¨â€çš„å¼€å‘åŸ¹è®­ï¼Œå› æ­¤æˆ‘èŠ±è´¹äº†å¤§é‡çš„æ—¶é—´æ¥å­¦ä¹ å¦‚ä½•ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚ä½•å†™å‡ºå¯æµ‹è¯•çš„ä»£ç ã€‚è¿™ä¹Ÿæ˜¯æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„åˆè¡·ï¼Œæˆ‘æƒ³æŠŠè‡ªå·±ç”¨ Swift å†™æµ‹è¯•æ—¶æ‘¸ç´¢åˆ°çš„å¿ƒå¾—åˆ†äº«ç»™å¤§å®¶ï¼Œå¸Œæœ›æˆ‘çš„è§è§£èƒ½å¤Ÿå¸®åŠ©å¤§å®¶èŠ‚çœå­¦ä¹ æ—¶é—´ï¼Œå°‘èµ°äº›å¼¯è·¯ã€‚</p>
<a id="more"></a>
<p>åœ¨è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä¼šè®¨è®ºç€æ‰‹å†™æµ‹è¯•çš„å…¥é—¨çŸ¥è¯†ï¼š<strong>ä¾èµ–æ³¨å…¥</strong>ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­¤æ—¶æ­£åœ¨å†™æµ‹è¯•ã€‚<br>å¦‚æœä½ çš„æµ‹è¯•å¯¹è±¡(è¢«æµ‹ç³»ç»Ÿ)æ˜¯å’ŒçœŸå®ä¸–ç•Œç›¸è¿çš„ï¼Œæ¯”å¦‚ Networking å’Œ CoreDataï¼Œç¼–å†™æµ‹è¯•ä»£ç å°†ä¼šéå¸¸å¤æ‚ã€‚åŸåˆ™ä¸Šè®²ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æˆ‘ä»¬çš„æµ‹è¯•ä»£ç è¢«å®¢è§‚ä¸–ç•Œçš„äº‹ç‰©æ‰€å½±å“ã€‚è¢«æµ‹ç³»ç»Ÿä¸åº”ä¾èµ–äºå…¶ä»–çš„å¤æ‚ç³»ç»Ÿï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½å¤Ÿä¿è¯åœ¨æ—¶é—´æ’å®šå’Œç¯å¢ƒæ’å®šæ¡ä»¶ä¸‹è¿…é€Ÿå®Œæˆæµ‹è¯•ã€‚å†µä¸”ï¼Œä¿è¯æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ä¸ä¼šâ€œæ±¡æŸ“â€ç”Ÿäº§ç¯å¢ƒä¹Ÿæ˜¯ååˆ†é‡è¦çš„ã€‚â€œæ±¡æŸ“â€æ„å‘³ç€ä»€ä¹ˆï¼Ÿæ„å‘³ç€æˆ‘ä»¬çš„æµ‹è¯•ä»£ç å°†ä¸€äº›æµ‹è¯•å¯¹è±¡å†™è¿›äº†æ•°æ®åº“ï¼Œæäº¤äº†äº›æµ‹è¯•æ•°æ®åˆ°ç”Ÿäº§æœåŠ¡å™¨ç­‰ç­‰ã€‚è€Œé¿å…è¿™äº›æƒ…å†µçš„å‘ç”Ÿå°±æ˜¯ <strong>ä¾èµ–æ³¨å…¥</strong> å­˜åœ¨çš„æ„ä¹‰ã€‚</p>
<p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªä¾‹å­å¼€å§‹ã€‚<br>å‡è®¾ä½ æ‹¿åˆ°ä¸ªåº”è¯¥è”ç½‘å¹¶ä¸”åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹æ‰èƒ½è¢«æ‰§è¡Œçš„ç±»ï¼Œè”ç½‘éƒ¨åˆ†å°±è¢«ç§°ä½œè¯¥ç±»çš„ <strong>ä¾èµ–</strong>ã€‚å¦‚ä¹‹å‰æ‰€è¨€ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œæµ‹è¯•æ—¶è¿™ä¸ªç±»çš„è”ç½‘éƒ¨åˆ†å¿…é¡»èƒ½å¤Ÿè¢«æ¨¡æ‹Ÿçš„ï¼Œæˆ–è€…å‡çš„ç¯å¢ƒæ‰€æ›¿æ¢ã€‚æ¢å¥è¯è¯´ï¼Œè¯¥ç±»çš„ä¾èµ–å¿…é¡»æ”¯æŒâ€œå¯æ³¨å…¥â€ï¼Œä¾èµ–æ³¨å…¥ä½¿æˆ‘ä»¬çš„ç³»ç»Ÿæ›´åŠ çµæ´»ã€‚æˆ‘ä»¬èƒ½å¤Ÿä¸ºç”Ÿäº§ä»£ç â€œæ³¨å…¥â€çœŸå®çš„ç½‘ç»œç¯å¢ƒï¼›ä¸æ­¤åŒæ—¶ï¼Œä¹Ÿèƒ½å¤Ÿâ€œæ³¨å…¥â€æ¨¡æ‹Ÿçš„ç½‘ç»œç¯å¢ƒæ¥è®©æˆ‘ä»¬åœ¨ä¸è®¿é—®äº’è”ç½‘çš„æ¡ä»¶ä¸‹è¿è¡Œæµ‹è¯•ä»£ç ã€‚</p>
<h3 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h3><blockquote>
<p>è¯‘è€…æ³¨ï¼šTL;DR æ˜¯ Too long;Donâ€™t read çš„ç¼©å†™ã€‚åœ¨è¿™é‡Œçš„æ„æ€æ˜¯ç¯‡å¹…è¾ƒé•¿ï¼Œä¸æƒ³æ·±å…¥ç ”ç©¶ï¼Œè¯·ç›´æ¥çœ‹æ–‡ç« æ€»ç»“ã€‚</p>
</blockquote>
<p>åœ¨è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä¼šè®¨è®ºï¼š</p>
<ol>
<li>å¦‚ä½•ä½¿ç”¨ <strong>ä¾èµ–æ³¨å…¥</strong> æŠ€æœ¯è®¾è®¡ä¸€ä¸ªå¯¹è±¡</li>
<li>åœ¨ Swift ä¸­å¦‚ä½•ä½¿ç”¨åè®®è®¾è®¡ä¸€ä¸ªæ¨¡æ‹Ÿå¯¹è±¡</li>
<li>å¦‚ä½•æµ‹è¯•å¯¹è±¡ä½¿ç”¨çš„æ•°æ®åŠå¦‚ä½•æµ‹è¯•å¯¹è±¡çš„è¡Œä¸º</li>
</ol>
<h3 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h3><p>å¼€å§‹åŠ¨æ‰‹å§! ç°åœ¨æˆ‘ä»¬æ‰“ç®—å®ç°ä¸€ä¸ªå«åš <strong>HttpClient</strong> çš„ç±»ã€‚è¿™ä¸ª HttpClient åº”è¯¥æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</p>
<ol>
<li>HttpClient è·Ÿåˆå§‹çš„ç½‘ç»œç»„ä»¶å¯¹äºåŒä¸€ URL åº”æäº¤åŒæ ·çš„ requestã€‚</li>
<li>HttpClient åº”èƒ½å¤Ÿæäº¤ requestã€‚</li>
</ol>
<p>æ‰€ä»¥æˆ‘ä»¬å¯¹ HttpClient çš„åˆæ¬¡å®ç°æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> HttpClient &#123;</div><div class="line">    typealias completeClosure = ( _ data: Data?, _ <span class="keyword">error</span>: <span class="keyword">Error</span>?)-&gt;Void</div><div class="line">    func <span class="keyword">get</span>( url: URL, callback: @escaping completeClosure ) &#123;</div><div class="line">        <span class="keyword">let</span> <span class="built_in">request</span> = NSMutableURLRequest(url: url)</div><div class="line">        <span class="built_in">request</span>.httpMethod = <span class="string">"GET"</span></div><div class="line">        <span class="keyword">let</span> task = URLSession.shared.dataTask(<span class="keyword">with</span>: <span class="built_in">request</span>) &#123; (data, <span class="built_in">response</span>, <span class="keyword">error</span>) <span class="keyword">in</span></div><div class="line">            callback(data, <span class="keyword">error</span>)</div><div class="line">        &#125;</div><div class="line">        task.<span class="keyword">resume</span>()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>HttpClient çœ‹èµ·æ¥å¯ä»¥æäº¤ä¸€ä¸ª â€œGETâ€ è¯·æ±‚ï¼Œå¹¶é€šè¿‡ â€œcallbackâ€ é—­åŒ…å°†è¿”å›å€¼å›ä¼ ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">HttpClient</span><span class="params">()</span></span>.get(url: url) &#123; (success, response) <span class="keyword">in</span> <span class="comment">// Return data &#125;</span></div></pre></td></tr></table></figure>
<p>HttpClient çš„ç”¨æ³•ã€‚</p>
<p>è¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨ï¼šæˆ‘ä»¬æ€ä¹ˆå¯¹å®ƒæµ‹è¯•ï¼Ÿæˆ‘ä»¬å¦‚ä½•ç¡®ä¿è¿™äº›ä»£ç è¾¾åˆ°ä¸Šè¿°çš„ä¸¤ç‚¹è¦æ±‚ï¼Ÿå‡­ç›´è§‰ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ HttpClient ä¼ å…¥ä¸€ä¸ª URLï¼Œè¿è¡Œä»£ç ï¼Œç„¶ååœ¨é—­åŒ…é‡Œè§‚å¯Ÿå¾—åˆ°çš„ç»“æœã€‚ä½†æ˜¯è¿™äº›æ“ä½œæ„å‘³ç€æˆ‘ä»¬åœ¨è¿è¡Œ HttpClient æ—¶å¿…é¡»æ¯æ¬¡éƒ½è¿æ¥äº’è”ç½‘ã€‚æ›´ç³Ÿç³•çš„æ˜¯å¦‚æœä½ æµ‹è¯•çš„ URL æ˜¯è¿æ¥ç”Ÿäº§æœåŠ¡å™¨ï¼šä½ çš„æµ‹è¯•åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½ï¼Œè€Œä¸”ä½ æäº¤çš„æµ‹è¯•æ•°æ®å°†ä¼šè¢«æäº¤åˆ°çœŸå®çš„ä¸–ç•Œã€‚å°±åƒæˆ‘ä»¬ä¹‹å‰æè¿°çš„ï¼Œæˆ‘ä»¬å¿…é¡»è®© HttpClient â€œå¯æµ‹è¯•â€ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹ URLSessionã€‚URLSession æ˜¯ HttpClient çš„ä¸€ç§â€˜ç¯å¢ƒâ€™ï¼Œæ˜¯ HttpClient è¿æ¥äº’è”ç½‘çš„å…¥å£ã€‚è¿˜è®°å¾—æˆ‘ä»¬åˆšè®¨è®ºçš„â€œå¯æµ‹è¯•â€ä»£ç å—ï¼Ÿ æˆ‘ä»¬éœ€è¦å°†äº’è”ç½‘éƒ¨åˆ†å˜å¾—å¯æ›¿æ¢ï¼Œäºæ˜¯æˆ‘ä»¬ä¿®æ”¹äº† HttpClient çš„å®ç°ï¼š</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> HttpClient &#123;</div><div class="line">    typealias completeClosure = ( _ data: Data?, _ <span class="keyword">error</span>: <span class="keyword">Error</span>?)-&gt;Void</div><div class="line">    <span class="keyword">private</span> <span class="keyword">let</span> session: URLSession</div><div class="line">    init(session: URLSessionProtocol) &#123;</div><div class="line">        self.session = session</div><div class="line">    &#125;</div><div class="line">    func <span class="keyword">get</span>( url: URL, callback: @escaping completeClosure ) &#123;</div><div class="line">        <span class="keyword">let</span> <span class="built_in">request</span> = NSMutableURLRequest(url: url)</div><div class="line">        <span class="built_in">request</span>.httpMethod = <span class="string">"GET"</span></div><div class="line">        <span class="keyword">let</span> task = session.dataTask(<span class="keyword">with</span>: <span class="built_in">request</span>) &#123; (data, <span class="built_in">response</span>, <span class="keyword">error</span>) <span class="keyword">in</span></div><div class="line">            callback(data, <span class="keyword">error</span>)</div><div class="line">        &#125;</div><div class="line">        task.<span class="keyword">resume</span>()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let task = URLSession<span class="selector-class">.shared</span><span class="selector-class">.dataTask</span>()</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹æˆäº†</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> <span class="attr">task</span> = session.dataTask()</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¢åŠ äº†æ–°çš„å˜é‡ï¼š<strong>session</strong>ï¼Œå¹¶æ·»åŠ äº†å¯¹åº”çš„ <strong>init</strong> æ–¹æ³•ã€‚ä¹‹åæ¯å½“æˆ‘ä»¬åˆ›å»º HttpClient å¯¹è±¡æ—¶ï¼Œå°±å¿…é¡»åˆå§‹åŒ– <strong>session</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å·²ç»å°† session â€œæ³¨å…¥â€åˆ°äº†æˆ‘ä»¬åˆ›å»ºçš„ HttpClient å¯¹è±¡ä¸­ã€‚ç°åœ¨æˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨è¿è¡Œç”Ÿäº§ä»£ç æ—¶æ³¨å…¥ â€˜URLSession.sharedâ€™ï¼Œè€Œè¿è¡Œæµ‹è¯•ä»£ç æ—¶æ³¨å…¥ä¸€ä¸ªæ¨¡æ‹Ÿçš„ sessionã€‚Bingo!</p>
<p>è¿™æ—¶ HttpClient çš„ç”¨æ³•å°±å˜æˆäº†ï¼šHttpClient(session: SomeURLSession() ).get(url: url) { (success, response) in // Return data }</p>
<p>ç»™æ­¤æ—¶çš„ HttpClient å†™æµ‹è¯•ä»£ç å°±ä¼šå˜å¾—éå¸¸ç®€å•ã€‚å› æ­¤æˆ‘ä»¬å¼€å§‹å¸ƒç½®æˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpClientTests</span>: <span class="title">XCTestCase</span> </span>&#123; </div><div class="line">    <span class="keyword">var</span> httpClient: <span class="type">HttpClient</span>! </div><div class="line">    <span class="keyword">let</span> session = <span class="type">MockURLSession</span>()</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUp</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.setUp()</div><div class="line">        httpClient = <span class="type">HttpClient</span>(session: session)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tearDown</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.tearDown()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸ªè§„èŒƒçš„ XCTestCase è®¾ç½®ã€‚<strong>httpClient</strong> å˜é‡å°±æ˜¯è¢«æµ‹ç³»ç»Ÿï¼Œ<strong>session</strong> å˜é‡æ˜¯æˆ‘ä»¬å°†ä¸º httpClient æ³¨å…¥çš„ç¯å¢ƒã€‚å› ä¸ºæˆ‘ä»¬è¦åœ¨æµ‹è¯•ç¯å¢ƒè¿è¡Œä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å°† MockURLSession å¯¹è±¡ä¼ ç»™ <strong>session</strong>ã€‚è¿™æ—¶æˆ‘ä»¬å°†æ¨¡æ‹Ÿçš„ <strong>session</strong> æ³¨å…¥åˆ°äº† httpClientï¼Œä½¿å¾— httpClient åœ¨ URLSession.shared è¢«æ›¿æ¢æˆ MockURLSession çš„æƒ…å†µä¸‹è¿è¡Œã€‚</p>
<h3 id="æµ‹è¯•æ•°æ®"><a href="#æµ‹è¯•æ•°æ®" class="headerlink" title="æµ‹è¯•æ•°æ®"></a>æµ‹è¯•æ•°æ®</h3><p>ç°åœ¨è®©æˆ‘ä»¬æ³¨æ„ä¸‹ç¬¬ä¸€ç‚¹è¦æ±‚ï¼š</p>
<ol>
<li>HttpClient å’Œåˆå§‹çš„ç½‘ç»œç»„ä»¶å¯¹äºåŒä¸€ URL åº”æäº¤åŒæ ·çš„ request ã€‚</li>
</ol>
<p>æˆ‘ä»¬æƒ³è¾¾åˆ°çš„æ•ˆæœæ˜¯ç¡®ä¿è¯¥ request çš„ url å’Œæˆ‘ä»¬ä¼ å…¥ â€œgetâ€ æ–¹æ³•çš„ url å®Œå…¨ä¸€è‡´ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test_get_request_withURL</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://mockurl"</span>) <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">fatalError</span>(<span class="string">"URL can't be empty"</span>)</div><div class="line">    &#125;</div><div class="line">    httpClient.<span class="keyword">get</span>(url: url) &#123; (success, response) <span class="keyword">in</span></div><div class="line">        <span class="comment">// Return data</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// Assert </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹å¯è¡¨ç¤ºä¸ºï¼š</p>
<ul>
<li><strong>Precondition</strong>: Given a url â€œ<a href="https://mockurlâ€" target="_blank" rel="external">https://mockurlâ€</a></li>
<li><strong>When</strong>: Submit a http GET request</li>
<li><strong>Assert</strong>: The submitted url should be equal to â€œ<a href="https://mockurlâ€" target="_blank" rel="external">https://mockurlâ€</a></li>
</ul>
<p>æˆ‘ä»¬è¿˜éœ€è¦å†™æ–­è¨€éƒ¨åˆ†ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆçŸ¥é“ HttpClient çš„ â€œgetâ€ æ–¹æ³•ç¡®å®æäº¤äº†æ­£ç¡®çš„ url å‘¢ï¼Ÿè®©æˆ‘ä»¬å†çœ‹çœ¼ä¾èµ–ï¼šURLSessionã€‚é€šå¸¸ï¼Œâ€œgetâ€ æ–¹æ³•ä¼šç”¨æ‹¿åˆ°çš„ url åˆ›å»ºä¸€ä¸ª requestï¼Œå¹¶æŠŠ request ä¼ ç»™ URLSession æ¥å®Œæˆæäº¤:</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> task = session.dataTask(<span class="keyword">with</span>: <span class="built_in">request</span>) &#123; (data, <span class="built_in">response</span>, <span class="keyword">error</span>) <span class="keyword">in</span></div><div class="line">    callback(data, <span class="keyword">error</span>)</div><div class="line">&#125;</div><div class="line">task.<span class="keyword">resume</span>()</div></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒä¸­ request å°†ä¼šä¼ ç»™ MockURLSessionï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦ hack è¿›æˆ‘ä»¬è‡ªå·±çš„ MockURLSession å°±å¯ä»¥æŸ¥çœ‹ request æ˜¯å¦è¢«æ­£ç¡®åˆ›å»ºäº†ã€‚</p>
<p>ä¸‹é¢æ˜¯ MockURLSession çš„ç²—ç•¥å®ç°ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockURLSession</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> (<span class="keyword">set</span>) <span class="keyword">var</span> lastURL: <span class="type">URL</span>?</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dataTask</span><span class="params">(with request: NSURLRequest, completionHandler: @escaping DataTaskResult)</span></span> -&gt; <span class="type">URLSessionDataTask</span> &#123;</div><div class="line">        lastURL = request.url</div><div class="line">        completionHandler(nextData, successHttpURLResponse(request: request), nextError)        </div><div class="line">        <span class="keyword">return</span> <span class="comment">// dataTask, will be impletmented later</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MockURLSession çš„ä½œç”¨å’Œ URLSession ä¸€æ ·ï¼ŒURLSession å’Œ MockURLSession æœ‰åŒæ ·çš„ dataTask() æ–¹æ³•å’Œç›¸åŒçš„å›è°ƒé—­åŒ…ç±»å‹ã€‚è™½ç„¶ URLSession æ¯” MockURLSession çš„ dataTask() åšäº†æ›´å¤šçš„å·¥ä½œï¼Œä½†å®ƒä»¬çš„æ¥å£æ˜¯ç±»ä¼¼çš„ã€‚æ­£æ˜¯ç”±äºå®ƒä»¬çš„æ¥å£ç›¸ä¼¼ï¼Œæˆ‘ä»¬æ‰èƒ½ä¸éœ€è¦ä¿®æ”¹ â€œgetâ€ æ–¹æ³•å¤ªå¤šä»£ç å°±å¯ä»¥ç”¨ MockURLSession æ›¿æ¢æ‰ URLSessionã€‚æ¥ç€æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <strong>lastURL</strong> å˜é‡æ¥è·Ÿè¸ª â€œgetâ€ æ–¹æ³•æäº¤çš„æœ€ç»ˆ url ã€‚ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯å½“æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ³¨å…¥ MockURLSession çš„ HttpClientï¼Œç„¶åè§‚å¯Ÿ url æ˜¯å¦å‰åç›¸åŒã€‚</p>
<p>ä»¥ä¸‹æ˜¯æµ‹è¯•ç”¨ä¾‹çš„å¤§æ¦‚å®ç°ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test_get_request_withURL</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://mockurl"</span>) <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">fatalError</span>(<span class="string">"URL can't be empty"</span>)</div><div class="line">    &#125;</div><div class="line">    httpClient.<span class="keyword">get</span>(url: url) &#123; (success, response) <span class="keyword">in</span></div><div class="line">        <span class="comment">// Return data</span></div><div class="line">    &#125;</div><div class="line">    <span class="type">XCTAssert</span>(session.lastURL == url)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¸º <strong>lastURL</strong> å’Œ <strong>url</strong> æ·»åŠ æ–­è¨€ï¼Œè¿™æ ·å°±ä¼šå¾—çŸ¥æ³¨å…¥åçš„ â€œgetâ€ æ–¹æ³•æ˜¯å¦æ­£ç¡®åˆ›å»ºäº†å¸¦æœ‰æ­£ç¡® url çš„ requestã€‚</p>
<p>ä¸Šé¢çš„ä»£ç ä»æœ‰ä¸€å¤„åœ°æ–¹éœ€è¦å®ç°ï¼š<code>return // dataTask</code>ã€‚åœ¨ URLSession ä¸­è¿”å›å€¼å¿…é¡»æ˜¯ä¸ª URLSessionDataTask å¯¹è±¡ï¼Œä½†æ˜¯ URLSessionDataTask å·²ç»ä¸èƒ½æ­£å¸¸åˆ›å»ºäº†ï¼Œæ‰€ä»¥è¿™ä¸ª URLSessionDataTask å¯¹è±¡ä¹Ÿéœ€è¦è¢«æ¨¡æ‹Ÿåˆ›å»ºï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockURLSessionDataTask</span> </span>&#123;  </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">resume</span><span class="params">()</span></span> &#123; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½œä¸º URLSessionDataTaskï¼Œæ¨¡æ‹Ÿå¯¹è±¡éœ€è¦æœ‰ç›¸åŒçš„æ–¹æ³• resume()ã€‚è¿™æ ·æ‰ä¼šæŠŠæ¨¡æ‹Ÿå¯¹è±¡å½“åš dataTask() çš„è¿”å›å€¼ã€‚</p>
<p>å¦‚æœä½ è·Ÿç€æˆ‘ä¸€å—æ•²ä»£ç ï¼Œå°±ä¼šå‘ç°ä½ çš„ä»£ç ä¼šè¢«ç¼–è¯‘å™¨æŠ¥é”™ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpClientTests</span>: <span class="title">XCTestCase</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> httpClient: <span class="type">HttpClient</span>!</div><div class="line">    <span class="keyword">let</span> session = <span class="type">MockURLSession</span>()</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUp</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.setUp()</div><div class="line">        httpClient = <span class="type">HttpClient</span>(session: session) <span class="comment">// Doesn't compile </span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tearDown</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.tearDown()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸º MockURLSession å’Œ URLSession çš„æ¥å£ä¸ä¸€æ ·ã€‚æ‰€ä»¥å½“æˆ‘ä»¬è¯•ç€æ³¨å…¥ MockURLSession çš„æ—¶å€™ä¼šå‘ç° MockURLSession å¹¶ä¸èƒ½è¢«ç¼–è¯‘å™¨è¯†åˆ«ã€‚æˆ‘ä»¬å¿…é¡»è®©æ¨¡æ‹Ÿçš„å¯¹è±¡å’ŒçœŸå®å¯¹è±¡æ‹¥æœ‰ç›¸åŒçš„æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥äº† â€œåè®®â€ !</p>
<p>HttpClient çš„ä¾èµ–ï¼š</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">let</span> session: URLSession</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¸Œæœ›ä¸è®º URLSession è¿˜æ˜¯ MockURLSession éƒ½å¯ä»¥ä½œä¸º session å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬å°† session çš„ URLSession ç±»å‹æ”¹ä¸º URLSessionProtocol åè®®ï¼š</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">let</span> session: URLSessionProtocol</div></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿæ³¨å…¥ URLSession æˆ– MockURLSession æˆ–è€…å…¶å®ƒéµå¾ªè¿™ä¸ªåè®®çš„å¯¹è±¡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯åè®®çš„å®ç°ï¼š</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">protocol URLSessionProtocol &#123; typealias <span class="function"><span class="title">DataTaskResult</span> = <span class="params">(Data?, URLResponse?, Error?)</span> -&gt;</span> Void</div><div class="line">    func dataTask<span class="function"><span class="params">(<span class="keyword">with</span> request: NSURLRequest, completionHandler: @escaping DataTaskResult)</span> -&gt;</span> URLSessionDataTaskProtocol</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç ä¸­æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªæ–¹æ³•ï¼š<code>dataTask(NSURLRequest, DataTaskResult)</code>ï¼Œå› æ­¤åœ¨åè®®ä¸­æˆ‘ä»¬ä¹Ÿåªéœ€å®šä¹‰ä¸€ä¸ªå¿…é¡»å®ç°çš„æ–¹æ³•ã€‚å½“æˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿä¸å±äºæˆ‘ä»¬çš„å¯¹è±¡æ—¶è¿™ä¸ªæŠ€æœ¯é€šå¸¸å¾ˆé€‚ç”¨ã€‚</p>
<p>è¿˜è®°å¾— MockURLDataTask å—ï¼Ÿå¦ä¸€ä¸ªä¸å±äºæˆ‘ä»¬çš„å¯¹è±¡ï¼Œæ˜¯çš„ï¼Œæˆ‘ä»¬è¦å†åˆ›å»ºä¸ªåè®®ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">URLSessionDataTaskProtocol</span> </span>&#123; <span class="function"><span class="keyword">func</span> <span class="title">resume</span><span class="params">()</span></span> &#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜éœ€è®©çœŸå®çš„å¯¹è±¡éµå¾ªè¿™ä¸ªåè®®ã€‚</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">extension URLSession: <span class="keyword">URLSessionProtocol</span> &#123;&#125;</div><div class="line"><span class="keyword">extension</span> <span class="keyword">URLSessionDataTask</span>: <span class="keyword">URLSessionDataTaskProtocol</span> &#123;&#125;</div></pre></td></tr></table></figure>
<p>URLSessionDataTask æœ‰ä¸ªåŒæ ·çš„ resume() åè®®æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é¡¹ä¿®æ”¹å¯¹äº URLSessionDataTask æ˜¯æ²¡æœ‰å½±å“çš„ã€‚</p>
<p>é—®é¢˜æ˜¯ URLSession æ²¡æœ‰ dataTask() æ–¹æ³•æ¥è¿”å› URLSessionDataTaskProtocol åè®®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‹“å±•æ–¹æ³•æ¥éµå¾ªåè®®ã€‚</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">extension</span> <span class="selector-tag">URLSession</span>: <span class="selector-tag">URLSessionProtocol</span> &#123;</div><div class="line">    <span class="selector-tag">func</span> <span class="selector-tag">dataTask</span>(with <span class="attribute">request</span>: NSURLRequest, <span class="attribute">completionHandler</span>: <span class="variable">@escaping</span> DataTaskResult) <span class="selector-tag">-</span>&gt; <span class="selector-tag">URLSessionDataTaskProtocol</span> &#123;</div><div class="line">        <span class="selector-tag">return</span> <span class="selector-tag">dataTask</span>(<span class="attribute">with</span>: request, <span class="attribute">completionHandler</span>: completionHandler) <span class="selector-tag">as</span> <span class="selector-tag">URLSessionDataTaskProtocol</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªç®€å•çš„æ–¹æ³•åªæ˜¯å°†è¿”å›ç±»å‹ä» URLSessionDataTask æ”¹æˆäº† URLSessionDataTaskProtocolï¼Œä¸ä¼šå½±å“åˆ° dataTask() çš„å…¶å®ƒè¡Œä¸ºã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å°±èƒ½å¤Ÿè¡¥å…¨ MockURLSession ç¼ºå¤±çš„éƒ¨åˆ†äº†ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockURLSession</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> (<span class="keyword">set</span>) <span class="keyword">var</span> lastURL: <span class="type">URL</span>?</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dataTask</span><span class="params">(with request: NSURLRequest, completionHandler: @escaping DataTaskResult)</span></span> -&gt; <span class="type">URLSessionDataTask</span> &#123;</div><div class="line">        lastURL = request.url</div><div class="line">        completionHandler(nextData, successHttpURLResponse(request: request), nextError)        </div><div class="line">        <span class="keyword">return</span> <span class="comment">// dataTask, will be impletmented later</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“   // dataTaskâ€¦ å¯ä»¥æ˜¯ä¸€ä¸ª MockURLSessionDataTaskï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockURLSession</span>: <span class="title">URLSessionProtocol</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> nextDataTask = <span class="type">MockURLSessionDataTask</span>()</div><div class="line">    <span class="keyword">private</span> (<span class="keyword">set</span>) <span class="keyword">var</span> lastURL: <span class="type">URL</span>?</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dataTask</span><span class="params">(with request: NSURLRequest, completionHandler: @escaping DataTaskResult)</span></span> -&gt; <span class="type">URLSessionDataTaskProtocol</span> &#123;</div><div class="line">        lastURL = request.url</div><div class="line">        completionHandler(nextData, successHttpURLResponse(request: request), nextError)</div><div class="line">        <span class="keyword">return</span> nextDataTask</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨æµ‹è¯•ç¯å¢ƒä¸­æ¨¡æ‹Ÿå¯¹è±¡å°±ä¼šå……å½“ URLSession çš„è§’è‰²ï¼Œå¹¶ä¸” url ä¹Ÿèƒ½å¤Ÿè¢«è®°å½•ä¾›æ–­è¨€åˆ¤æ–­ã€‚æ˜¯ä¸æ˜¯æœ‰ç§ä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·çš„æ„Ÿè§‰! æ‰€æœ‰çš„ä»£ç éƒ½å·²ç»ç¼–è¯‘å®Œæˆå¹¶ä¸”æµ‹è¯•ä¹Ÿé¡ºåˆ©é€šè¿‡ï¼</p>
<p>è®©æˆ‘ä»¬ç»§ç»­ã€‚</p>
<h3 id="æµ‹è¯•è¡Œä¸º"><a href="#æµ‹è¯•è¡Œä¸º" class="headerlink" title="æµ‹è¯•è¡Œä¸º"></a>æµ‹è¯•è¡Œä¸º</h3><p>ç¬¬äºŒç‚¹è¦æ±‚æ˜¯ï¼š</p>
<p><code>The HttpClient should submit the request</code></p>
<p>æˆ‘ä»¬å¸Œæœ› HttpClient çš„ â€œgetâ€ æ–¹æ³•å°† request å¦‚é¢„æœŸåœ°æäº¤ã€‚</p>
<p>å’Œä¹‹å‰éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®çš„æµ‹è¯•ä¸åŒï¼Œæˆ‘ä»¬ç°åœ¨è¦æµ‹è¯•çš„æ˜¯æ–¹æ³•æ˜¯å¦è¢«é¡ºåˆ©è°ƒç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“ URLSessionDataTask.resume() æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨äº†ã€‚è®©æˆ‘ä»¬ç»§ç»­ä½¿ç”¨åˆšæ‰çš„è€æŠŠæˆï¼š<br>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ resumeWasCalled å˜é‡æ¥è®°å½• resume() æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ã€‚</p>
<p>æˆ‘ä»¬ç®€å•å†™ä¸€ä¸ªæµ‹è¯•ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test_get_resume_called</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">let</span> dataTask = <span class="type">MockURLSessionDataTask</span>()</div><div class="line">    session.nextDataTask = dataTask</div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://mockurl"</span>) <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">fatalError</span>(<span class="string">"URL can't be empty"</span>)</div><div class="line">    &#125;</div><div class="line">    httpClient.<span class="keyword">get</span>(url: url) &#123; (success, response) <span class="keyword">in</span></div><div class="line">        <span class="comment">// Return data</span></div><div class="line">    &#125;</div><div class="line">    <span class="type">XCTAssert</span>(dataTask.resumeWasCalled)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>dataTask</strong> å˜é‡æ˜¯æˆ‘ä»¬è‡ªå·±æ‹¥æœ‰çš„æ¨¡æ‹Ÿå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªå±æ€§æ¥ç›‘æ§ resume() æ–¹æ³•çš„è¡Œä¸ºï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockURLSessionDataTask</span>: <span class="title">URLSessionDataTaskProtocol</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> (<span class="keyword">set</span>) <span class="keyword">var</span> resumeWasCalled = <span class="literal">false</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">resume</span><span class="params">()</span></span> &#123;</div><div class="line">        resumeWasCalled = <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœ resume() æ–¹æ³•è¢«è°ƒç”¨äº†ï¼Œ<code>resumeWasCalled</code> å°±ä¼šè¢«è®¾ç½®æˆ <code>true</code>! :) å¾ˆç®€å•ï¼Œå¯¹ä¸å¯¹ï¼Ÿ</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å­¦åˆ°ï¼š</p>
<ol>
<li>å¦‚ä½•è°ƒæ•´ä¾èµ–æ³¨å…¥æ¥æ”¹å˜ç”Ÿäº§/æµ‹è¯•ç¯å¢ƒã€‚</li>
<li>å¦‚ä½•åˆ©ç”¨åè®®æ¥åˆ›å»ºæ¨¡æ‹Ÿå¯¹è±¡ã€‚</li>
<li>å¦‚ä½•æ£€æµ‹ä¼ å€¼çš„æ­£ç¡®æ€§ã€‚</li>
<li>å¦‚ä½•æ–­è¨€æŸä¸ªå‡½æ•°çš„è¡Œä¸ºã€‚</li>
</ol>
<p>åˆšèµ·æ­¥æ—¶ï¼Œä½ å¿…é¡»èŠ±è´¹å¤§é‡æ—¶é—´æ¥å†™ç®€å•çš„æµ‹è¯•ï¼Œè€Œä¸”æµ‹è¯•ä»£ç ä¹Ÿæ˜¯ä»£ç ï¼Œæ‰€ä»¥ä½ ä»éœ€è¦ä¿æŒæµ‹è¯•ä»£ç çš„ç®€æ´å’Œè‰¯å¥½çš„æ¶æ„ã€‚ä½†ç¼–å†™æµ‹è¯•ç”¨ä¾‹å¾—åˆ°çš„å¥½å¤„ä¹Ÿæ˜¯å¼¥è¶³çè´µçš„ï¼Œä»£ç åªæœ‰åœ¨æ°å½“çš„æµ‹è¯•åæ‰èƒ½è¢«æ‰©å±•ï¼Œæµ‹è¯•å¸®ä½ å…äºçç¢ bug çš„å›°æ‰°ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä¸€èµ·åŠ æ²¹å†™å¥½æµ‹è¯•å§!</p>
<p>æ‰€æœ‰çš„ç¤ºä¾‹ä»£ç éƒ½åœ¨ <a href="https://github.com/koromiko/Tutorial/blob/master/NetworkingUnitTest.playground/Contents.swift" target="_blank" rel="external">GitHub</a> ä¸Šï¼Œä»£ç æ˜¯ä»¥ Playground çš„å½¢å¼å±•ç¤ºçš„ï¼Œæˆ‘è¿˜åœ¨ä¸Šé¢æ·»åŠ äº†ä¸ªé¢å¤–çš„æµ‹è¯•ã€‚ ä½ å¯ä»¥è‡ªç”±ä¸‹è½½æˆ– fork è¿™äº›ä»£ç ï¼Œå¹¶ä¸”æ¬¢è¿ä»»ä½•åé¦ˆï¼</p>
<p>æ„Ÿè°¢é˜…è¯»æˆ‘çš„æ–‡ç«  ğŸ’š ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ol>
<li><a href="http://masilotti.com/testing-nsurlsession-input/" target="_blank" rel="external">Mocking Classes You Donâ€™t Own</a></li>
<li><a href="https://www.objc.io/issues/15-testing/dependency-injection/" target="_blank" rel="external">Dependency Injection</a></li>
<li><a href="https://www.amazon.com/Test-Driven-Development-Swift-Dominik-Hauser/dp/178588073X" target="_blank" rel="external">Test-Driven iOS Development with Swift</a></li>
</ol>
<p>æ„Ÿè°¢ <a href="https://medium.com/@lisadziuba?source=post_page" target="_blank" rel="external">Lisa Dziuba</a> å’Œ <a href="https://medium.com/@ahmedsulaiman?source=post_page" target="_blank" rel="external">Ahmed Sulaiman</a>.</p>
<hr>
<hr>
<blockquote>
<ul>
<li>è¯‘æ–‡å‡ºè‡ªï¼š<a href="https://github.com/xitu/gold-miner" target="_blank" rel="external">æ˜é‡‘ç¿»è¯‘è®¡åˆ’</a><ul>
<li>è¯‘è€…ï¼š    <a href="https://swants.github.io" target="_blank" rel="external">Swants</a></li>
<li>æ ¡å¯¹è€…ï¼š  <a href="https://github.com/pthtc" target="_blank" rel="external">pthtc</a> <a href="https://github.com/ZhiyuanSun" target="_blank" rel="external">ZhiyuanSun</a></li>
</ul>
</li>
</ul>
</blockquote>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018/05/14/å¦‚ä½•åˆ¤æ–­æŸç»çº¬åº¦æ˜¯å¦åœ¨åœ°å›¾ä¸è§„åˆ™åŒºåŸŸå†….html">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">å¦‚ä½•åˆ¤æ–­æŸç»çº¬åº¦æ˜¯å¦åœ¨åœ°å›¾ä¸è§„åˆ™åŒºåŸŸå†…</span>
        <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
      </a>
    
    
      <a class="next" href="/2018/01/12/Xcode-ç¯å¢ƒé…ç½®æœ€ä½³å®è·µ.html">
        <span class="next-text nav-default">Xcode ç¯å¢ƒé…ç½®æœ€ä½³å®è·µ</span>
        <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

<div class="copyright">

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2019

  
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  



    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.5.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.5.0"></script>

  </body>
</html>
